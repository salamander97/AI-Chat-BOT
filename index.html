<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Permissions-Policy" content="interest-cohort=()"/>

  <title>Local CHAT AI </title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f2f0e9;
      margin: 0;
      padding: 0;
      height: 100vh;
      box-sizing: border-box;
    }
    pre {
      background-color: #282c34; /* Thay đổi màu nền này theo ý của bạn */
    }
    .wrapper {
      position: relative;
      margin-bottom: 20px;
      /* Để giữ khoảng cá5ch 20px dưới banner */
    }
    @media only screen and (max-width: 1366px) {
  .message-display {
    width: 100%;
    border-radius: 20px;
  }
}

    .message-display {
      width: 50%;
      height: calc(100vh - 100px);
      background-color: #f2f1e9;
      overflow-y: auto;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding-top: 10px;
      box-sizing: border-box;
      overflow-y: auto; 
      margin: auto;
      border-radius: 20px;
    }

    .container {
      text-align: center;
      padding-top: 20px;
    }

    .banner {
      text-align: center;
      font-size: 40px;
      color: #000000;
      font-weight: bold;
      padding-top: 20px;
    }

    .title {
      font-size: 40px;
      color: #7a7373;
      font-weight: bold;
    }

    .subtitle {
      font-size: 40px;
      color: #7a7373;
      font-weight: bold;
      top: 50%;
    }

    .subtitle1 {
      font-size: 48px;
      font-weight: bold;
      color: #7a7373;
    }

    .footer {
      position: fixed;
      bottom: 10px;
      width: 100%;
      font-size: 15px;
      transform: translateX(-50%);
      left: 50%;
    }

    .chat-container {
      position: fixed;
      bottom: 30px;
      left: 0;
      right: 0;
      width: calc(100%);
      max-width: 700px;
      margin: auto;
      background-color: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 0px;
      box-sizing: border-box;
    }

    .chat-input {
      height: 53px;
      max-height: 200px;
      width: 100%;
      border: 1px solid #f8f8f7;
      border-radius: 20px;
      padding: 10px 20px;
      font-size: 16px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .send-button {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background-color: #5644a0;
      border: none;
      border-radius: 40%;
      padding: 10px;
      cursor: pointer;
    }

    /* Nút gửi*/
    .send-icon {
      fill: rgb(3, 3, 3);
      width: 15px;
      height: 15px;
    }

    .message {
      margin-left: 100px;
      margin-right: 20px;
      padding-top: 100px;
    }

    .message-container {
      max-width: 90%;
      word-wrap: break-word;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;        /*white-space: Không cho phép xuống dòng */
      display: flex;
      justify-content: flex-start;
      margin-bottom: 10px;          /*margin-bottom: Khoảng cách giữa các tin nhắn*/
      flex-direction: row;
    }

    .ai-message-container {
      max-width: 90%;
      word-wrap: break-word;    /*break-word: Tự động xuống dòng khi vượt quá chiều rộng*/
      overflow: hidden;         /*overflow: Ẩn phần dư thừa*/
      text-overflow: ellipsis;  /*text-overflow: Hiển thị dấu ... khi vượt quá chiều rộng*/
       white-space: normal;      /*white-space: Không cho phép xuống dòng */
      display: flex;
      justify-content: flex-start;
      margin-bottom: 10px;
      flex-direction: row;
    }
    .sender-name {
      display: flex;
      align-items: center;
      font-weight: bold;
      border-radius: 5px;
      text-decoration: underline;
      padding-top: 20px;
      margin-right: 10px;
    }
    .ai-sender-name {
      display: flex;
      align-items: center;
      font-weight: bold;
      border-radius: 5px;
      text-decoration: underline;
      padding-top: 20px;
      margin-right: 10px;
      /* Để tạo khoảng cách giữa tên người gửi và nội dung tin nhắn */
    }
    .sender-icon {          /*sender-icon: Ảnh người gửi */
      width: 30px;          /*width: Chiều rộng */
      height: 30px;         /*height: Chiều cao */
      margin-right: 5px;    /*margin-right: Khoảng cách với tin nhắn */
       margin-top: 8px;     /*margin-top: Khoảng cách với tin nhắn */
      margin-left: 10px;    /*margin-left: Khoảng cách với tin nhắn */
    }
    .ai-sender-icon {
      width: 30px;
      height: 30px;
      margin-right: 5px;
      margin-top: 8px;
      margin-left: 10px;
    }
    .message-text {
      background-color: #dfd7c8;
      border-radius: 10px;
      padding: 5px 10px;
      margin-left: 15px;
    }
    .ai-message-text {
      background-color: #ffffff;
      border-radius: 10px;
      padding: 5px 10px;
      margin-left: 15px;
    }
/* 
    .message-text,
    .sender-icon {
      position: absolute;
      top: calc(10% + 20px);
    }

    .ai-message-text,
    .ai-sender-icon {
      position: absolute;
      top: calc(10% + 60px);
    } */

    @keyframes fadeInOut {
      0% {opacity: 0;}
      50% {opacity: 1;}
      100% {opacity: 0;}
    }

    @keyframes pulse {
      0% {opacity: 1;}
      50% {opacity: 0.5;}
      100% {opacity: 1;}
    }
    /* .banner {animation: fadeInOut 1s infinite;} */
    .title,.subtitle,.subtitle1 {
      animation: pulse 2s infinite;}
    .hidden {display: none;}
  </style>
</head>

<body>
  <div class="wrapper">
    <div class="message-display" id="message-display">
      <div class="banner">LOCAL CHAT AI</div>
      <div class="container" id="container">
        <div class="title">CREATE</div>
        <div class="subtitle">by </div>
        <div class="subtitle1">TRUNGHIEU</div>
        <div class="footer">© Local Chat AI is created by <a href="https://github.com/salamander97?tab=repositories"
            target="_blank">Trung Hieu</a>.
        </div>
      </div>
    </div>
  </div>
  <div class="chat-container">
    <input type="text" class="chat-input" placeholder="Nhập tin nhắn..." id="user-input">
    <button class="send-button" id="send-button">
      <svg class="send-icon" viewBox="0 0 24 24">
        <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z" />
      </svg>
    </button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    const sendButton = document.getElementById('send-button');
    const messageDisplay = document.getElementById('message-display');
    const userInput = document.getElementById('user-input');
    const title = document.querySelector('.title');
    const subtitle = document.querySelector('.subtitle');
    const subtitle1 = document.querySelector('.subtitle1');

    // Trước khi thêm sự kiện click cho nút gửi
    // Tạo một div mới để chứa tất cả các tin nhắn
// Trước khi thêm sự kiện click cho nút gửi
// Tạo một div mới để chứa tất cả các tin nhắn
const messageContainerDiv = document.createElement('div');
messageContainerDiv.classList.add('message-container');
messageDisplay.appendChild(messageContainerDiv);

sendButton.addEventListener('click', async () => {
  const userMessage = userInput.value.trim();
  if (userMessage) {
    title.classList.add('hidden');
    subtitle.classList.add('hidden');
    subtitle1.classList.add('hidden');

    const userMessageContainer = createUserMessageContainer(userMessage);
    // Thêm tin nhắn người dùng vào cuối danh sách
    messageDisplay.appendChild(userMessageContainer);
    userMessageContainer.scrollIntoView({ behavior: 'smooth' });


    userInput.value = '';
  }

  const chatGPTKey = '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';
  const OPEN_AI_ENDPOINT = 'https://api.openai.com/v1/chat/completions';

  try {
    const response = await axios.post(
      `${OPEN_AI_ENDPOINT}`,
      {
        model: 'gpt-3.5-turbo',
        messages: [
          { role: 'system', content: 'You are a helpful assistant.' },
          { role: 'user', content: userMessage }
        ],
        temperature: 0.9,
        max_tokens: 1500,
      },
      {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${chatGPTKey}`,
        },
      }
    );

    if (!response.data.choices || response.data.choices.length === 0) {
      console.error('No valid response from the OpenAI API.');
      return;
    }

    const aiMessage = response.data.choices[0].message.content;
    const aiMessageContainer = createAiMessageContainer(aiMessage);
    // Thêm tin nhắn của chatbot vào cuối danh sách
    messageDisplay.appendChild(aiMessageContainer);
    aiMessageContainer.scrollIntoView({ behavior: 'smooth' })
  } catch (error) {
    console.error('Error:', error);
  }
});



function createUserMessageContainer(message) {
  const messageContainer = document.createElement('div');
  messageContainer.classList.add('message-container');

  const senderIcon = document.createElement('img');
  senderIcon.src = './icon/user.svg';
  senderIcon.classList.add('sender-icon');
  messageContainer.appendChild(senderIcon);

  const messageText = document.createElement('div');
  messageText.classList.add('message-text');
  messageContainer.appendChild(messageText);

  // Kiểm tra xem tin nhắn có phải là mã code không
  if (message.startsWith('```') && message.endsWith('```')) {
    // Tạo một thẻ <pre> và <code> để hiển thị mã
    const pre = document.createElement('pre');
    const code = document.createElement('code');
    code.classList.add('language-javascript'); // Thêm lớp PrismJS
    pre.appendChild(code);
    messageText.appendChild(pre);

    // Loại bỏ các dấu ``
    code.innerText = message.slice(3, -3);

    // Tô màu cú pháp mã với PrismJS
    Prism.highlightElement(code);
  } else {
    // Hiển thị tin nhắn bình thường
    messageText.innerText = message;
  }

  return messageContainer;
}
    function createAiMessageContainer(message) {
  const aiMessageContainer = document.createElement('div');
  aiMessageContainer.classList.add('ai-message-container');

  const aiSenderIcon = document.createElement('img');
  aiSenderIcon.src = './icon/ChatBOT.svg';
  aiSenderIcon.classList.add('ai-sender-icon');
  aiMessageContainer.appendChild(aiSenderIcon);

  const aiMessageText = document.createElement('div');
  aiMessageText.classList.add('ai-message-text');
  aiMessageContainer.appendChild(aiMessageText);

  // Hiển thị từng chữ một
  let i = 0;
  function typeWriter() {
    if (i < message.length) {
      // Kiểm tra xem tin nhắn có phải là mã code không
      if (message.charAt(i) === '`' && message.charAt(i+1) === '`' && message.charAt(i+2) === '`') {
        // Tạo một thẻ <pre> và <code> để hiển thị mã
        const pre = document.createElement('pre');
        const code = document.createElement('code');
        // Thêm lớp PrismJS để hiển thị mã
        code.classList.add('language-javascript');
        pre.appendChild(code);
        aiMessageText.appendChild(pre);

        // Bỏ qua các dấu ``
        i += 3;
        function typeWriterCode() {
          if (i < message.length && !(message.charAt(i) === '`' && message.charAt(i+1) === '`' && message.charAt(i+2) === '`')) {
            code.innerHTML += message.charAt(i);
            i++;
            setTimeout(typeWriterCode, 30); // Thời gian hiển thị giữa các chữ
          } else {
            // Bỏ qua các dấu ``
            i += 3;
            Prism.highlightElement(code);
            typeWriter();
          }
        }
        typeWriterCode();
      } else {
        aiMessageText.innerHTML += message.charAt(i);
        i++;
        setTimeout(typeWriter, 30); // Thời gian hiển thị giữa các chữ
      }
    }
  }
  typeWriter();

  return aiMessageContainer;
}
  </script>
</body>

</html>
